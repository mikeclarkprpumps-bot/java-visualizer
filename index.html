<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Java Visualizer – Chapters 9–12</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#4e6cff">

<style>
  :root {
    --bg: #f3f4f9;
    --accent: #4e6cff;
    --code-bg: #1e1e1e;
    --console-bg: #000;
  }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont,
                 "Segoe UI", Consolas, "Courier New", monospace;
    background: var(--bg);
    margin: 0;
  }

  .page {
    max-width: 1100px;
    margin: 0 auto;
    padding: 16px;
  }

  h1, h2 {
    text-align: center;
    margin: 4px 0;
  }

  h1 { font-size: 1.4rem; }
  h2 { font-size: 1.05rem; font-weight: 500; color: #333; }

  /* Tabs */
  #chapterTabs {
    display: flex;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
    margin: 10px 0;
  }

  .chap-tab {
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #555;
    font-size: 0.8rem;
    background: #fff;
    cursor: pointer;
  }
  .chap-tab.active {
    background: var(--accent);
    color: #fff;
  }

  /* Sticky highlight controls */
  #controlsWrapper {
    position: sticky;
    top: 0;
    z-index: 5;
    padding: 10px 0 6px;
    background: rgba(243,244,249,0.97);
    border-bottom: 1px solid #d0d2e0;
    backdrop-filter: blur(4px);
  }

  #controls {
    display: flex;
    gap: 6px;
    justify-content: center;
    flex-wrap: wrap;
  }

  button {
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #333;
    background: #fff;
    cursor: pointer;
    font-size: 0.8rem;
  }

  button:hover { background: #ececec; }

  /* Legend */
  .legend {
    text-align: center;
    font-size: .75rem;
    margin-bottom: 10px;
  }
  .legend span {
    padding: 2px 6px;
    border-radius: 4px;
    margin: 2px;
  }

  .field { background: rgba(0,200,255,.35); }
  .ctor  { background: rgba(0,255,0,.35); }
  .stat  { background: rgba(255,165,0,.35); }
  .thisc { background: rgba(255,0,255,.35); }
  .newc  { background: rgba(255,0,0,.35); }
  .inh   { background: rgba(155,89,182,.35); }
  .exc   { background: rgba(231,76,60,.35); }

  /* Chapter sections */
  .chapter-section { display: none; }
  .active-chap { display: block; animation: fadeIn .25s; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Code blocks */
  .code-title { font-weight: 600; margin: 18px 0 8px; }
  .code-block {
    background: var(--code-bg);
    color: #eaeaea;
    padding: 12px;
    border-radius: 10px;
    white-space: pre;
    overflow-x: auto;
    font-size: .82rem;
  }

  /* Console */
  .console-block {
    background: var(--console-bg);
    color: #00ff7f;
    padding: 10px;
    border-radius: 8px;
    white-space: pre;
    font-size: .8rem;
    min-height: 80px;
  }

  /* CH9 example picker */
  .ex9-picker { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; }
  .ex9-btn.active { background: var(--accent); color: #fff; }

  .ex9-layout {
    display: grid;
    grid-template-columns: 1.25fr 1fr;
    gap: 14px;
    margin-top: 18px;
  }

  @media(max-width:800px) {
    .ex9-layout { grid-template-columns: 1fr; }
  }

  /* Panels */
  .ex-panel {
    background: #fff;
    border: 1px solid #ddd;
    padding: 10px 12px;
    border-radius: 10px;
  }

  /* Explain hotspots ------------------------------------------------------ */
  .explainable {
    border-bottom: 1px dotted #ffd700;
    cursor: pointer;
  }
  #explainPanel {
    position: absolute;
    display: none;
    max-width: 300px;
    background: #fff;
    padding: 8px 10px;
    border-radius: 10px;
    font-size: .8rem;
    box-shadow: 0 2px 10px rgba(0,0,0,.25);
    z-index: 20;
  }
  #explainHeader {
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
  }
  #explainClose {
    background: none;
    border: none;
    font-size: 1rem;
    cursor: pointer;
  }

  /* Analyzer -------------------------------------------------------------- */
  #analyzeInput {
    width: 100%;
    min-height: 200px;
    font-family: Consolas, monospace;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: .85rem;
  }

  #analyzeCodeView {
    margin-bottom: 12px;
  }

  .analyzer-summary {
    padding: 8px 6px;
    background: #eef2ff;
    border-radius: 6px;
    margin-bottom: 8px;
    font-size: .85rem;
  }

  .analyzer-section-title {
    margin-top: 10px;
    margin-bottom: 4px;
    font-weight: 600;
    font-size: .85rem;
  }

  .analyzer-list {
    font-size: .82rem;
    padding-left: 18px;
  }

  /* Highlight classes for analyzer preview */
  .hl-field      { background: rgba(0,200,255,.35); }
  .hl-static     { background: rgba(255,165,0,.35); }
  .hl-new        { background: rgba(255,0,0,.35); }
  .hl-this       { background: rgba(255,0,255,.35); }
  .hl-inherit    { background: rgba(155,89,182,.35); }
  .hl-exception  { background: rgba(231,76,60,.35); }
</style>

<script>
// ------------------------------------------------------------
// TAB SWITCHING (Ch 9–12)
// ------------------------------------------------------------
function showChapter(ch) {
  document.querySelectorAll(".chap-tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".chapter-section").forEach(s => s.classList.remove("active-chap"));

  document.getElementById("tab" + ch).classList.add("active");
  document.getElementById("chapter" + ch).classList.add("active-chap");
}

// ------------------------------------------------------------
// HOTSPOTS (tap-to-explain)
// ------------------------------------------------------------
document.addEventListener("click", e => {
  const panel = document.getElementById("explainPanel");

  if (e.target.classList.contains("explainable")) {
    const msg = e.target.dataset.explain || "No explanation.";
    const rect = e.target.getBoundingClientRect();

    document.getElementById("explainText").textContent = msg;
    panel.style.display = "block";

    // position panel just below tapped line
    panel.style.left = rect.left + "px";
    panel.style.top = rect.bottom + window.scrollY + "px";
  } else {
    panel.style.display = "none";
  }
});

// ------------------------------------------------------------
// CHAPTER 9 EXAMPLE DATA
// ------------------------------------------------------------
const chapter9Examples = {
  "CircleWithStatic": {
    title: "CircleWithStaticMembers.java",
    code: `
public class <span class="stat explainable" data-explain="Static field shared across ALL objects">CircleWithStaticMembers</span> {
  double <span class="field explainable" data-explain="Instance field — each object gets its own radius">radius</span>;
  static int <span class="stat explainable" data-explain="Counts how many Circle objects have ever been created">numberOfObjects</span> = 0;

  <span class="ctor explainable" data-explain="Constructor with no parameters">CircleWithStaticMembers</span>() {
    <span class="thisc explainable" data-explain="Refers to the object's own instance field">radius</span> = 1.0;
    numberOfObjects++;
  }

  <span class="ctor explainable" data-explain="Constructor with one parameter">CircleWithStaticMembers</span>(double newRadius) {
    radius = newRadius;
    numberOfObjects++;
  }

  static int <span class="stat explainable" data-explain="Static method called on the class, not on an object">getNumberOfObjects</span>() {
    return numberOfObjects;
  }

  double getArea() {
    return radius * radius * Math.PI;
  }
}
`,
    console: `Before creating objects
The number of Circle objects is 0

After creating c1
c1: radius (1.0) and numberOfObjects (1)

After creating c2 and modifying c1
c1: radius (9.0) and numberOfObjects (2)
c2: radius (5.0) and numberOfObjects (2)`
  },

  "TV": {
    title: "TV.java",
    code: `
public class <span class="explainable" data-explain="A simple class modeling a TV">TV</span> {
  int <span class="field explainable" data-explain="Channel number">channel</span> = 1;
  int <span class="field explainable" data-explain="Volume level">volumeLevel</span> = 1;
  boolean <span class="field explainable" data-explain="Power state">on</span> = false;

  <span class="ctor explainable" data-explain="Constructor — creates a TV">TV</span>() {}

  void <span class="explainable" data-explain="Turns the TV on">turnOn</span>() {
    on = true;
  }

  void <span class="explainable" data-explain="Turns the TV off">turnOff</span>() {
    on = false;
  }

  void <span class="explainable" data-explain="Sets the channel if the TV is on">setChannel</span>(int newChannel) {
    if (on && newChannel >= 1 && newChannel <= 120)
      channel = newChannel;
  }
}
`,
    console: `TV on...
Channel set to 25`
  },

  "PassObject": {
    title: "TestPassObject.java",
    code: `
public class TestPassObject {
  public static void main(String[] args) {
    <span class="field explainable" data-explain="c references a Circle object">Circle c</span> = 
      <span class="newc explainable" data-explain="Creates an object in the heap">new</span> Circle(1);

    <span class="explainable" data-explain="Method receives object reference (not a copy)">printArea</span>(c);

    <span class="explainable" data-explain="Modifies the actual Circle object">c.radius</span> = 10;

    printArea(c);
  }

  public static void printArea(Circle c) {
    System.out.println("Radius = " + c.radius);
  }
}
`,
    console: `Radius = 1
Radius = 10`
  }
};

// ------------------------------------------------------------
// Load a Chapter 9 example
// ------------------------------------------------------------
function loadCH9Example(key) {
  document.querySelectorAll(".ex9-btn").forEach(b => b.classList.remove("active"));
  document.getElementById("btn_" + key).classList.add("active");

  document.getElementById("ex9Code").innerHTML = chapter9Examples[key].code;
  document.getElementById("ex9Console").textContent = chapter9Examples[key].console;

  // scroll to top of example
  document.getElementById("chapter9").scrollIntoView({ behavior: "smooth" });
}

// ------------------------------------------------------------
// UNIVERSAL COLORIZER (used by analyzer + examples)
// ------------------------------------------------------------
function applySemanticHighlight(html) {
  return html
    .replace(/new\s+[A-Z][A-Za-z0-9_]*/g, m => `<span class="hl-new">${m}</span>`)
    .replace(/this\./g, `<span class="hl-this">this.</span>`)
    .replace(/extends\s+[A-Z][A-Za-z0-9_]*/g, m => `<span class="hl-inherit">${m}</span>`)
    .replace(/throw\s+new\s+[A-Z][A-Za-z0-9_]*/g, m => `<span class="hl-exception">${m}</span>`)
    .replace(/\bstatic\b/g, `<span class="hl-static">static</span>`)
    .replace(/\bint\s+[a-zA-Z_][a-zA-Z0-9_]*/g, m => `<span class="hl-field">${m}</span>`);
}

// ------------------------------------------------------------
// ANALYZER MODE
// ------------------------------------------------------------
function analyzeCode() {
  const raw = document.getElementById("analyzeInput").value;
  if (!raw.trim()) return;

  // highlighted view
  const highlighted = applySemanticHighlight(
    raw.replace(/</g, "&lt;").replace(/>/g, "&gt;")
  );
  document.getElementById("analyzeCodeView").innerHTML =
    `<div class="code-block">${highlighted}</div>`;

  // extract structure
  const classes = [...raw.matchAll(/class\s+([A-Za-z_][A-Za-z0-9_]*)/g)].map(m => m[1]);
  const ctors = [...raw.matchAll(/([A-Za-z_][A-Za-z0-9_]*)\s*\(/g)]
                .map(m => m[1])
                .filter(name => classes.includes(name));
  const fields = [...raw.matchAll(/\b(int|double|boolean|String|char)\s+([a-zA-Z_][a-zA-Z0-9_]*)/g)]
                .map(m => `${m[1]} ${m[2]}`);
  const news = [...raw.matchAll(/new\s+[A-Z][A-Za-z0-9_]*/g)].map(m => m[0]);

  document.getElementById("analyzeSummary").innerHTML = `
    <div class="analyzer-summary">Found ${classes.length} class(es)</div>

    <div class="analyzer-section-title">Classes:</div>
    <ul class="analyzer-list">${classes.map(c => `<li>${c}</li>`).join("")}</ul>

    <div class="analyzer-section-title">Constructors:</div>
    <ul class="analyzer-list">${ctors.map(c => `<li>${c}(...)</li>`).join("")}</ul>

    <div class="analyzer-section-title">Fields:</div>
    <ul class="analyzer-list">${fields.map(f => `<li>${f}</li>`).join("")}</ul>

    <div class="analyzer-section-title">Object Creations:</div>
    <ul class="analyzer-list">${news.map(n => `<li>${n}</li>`).join("")}</ul>
  `;
}
</script>

<body>

<!-- ============================================================
   TOP NAV TABS
============================================================ -->
<div class="tab-bar">
  <div id="tab9"  class="chap-tab active" onclick="showChapter(9)">Chapter 9</div>
  <div id="tab10" class="chap-tab" onclick="showChapter(10)">Chapter 10</div>
  <div id="tab11" class="chap-tab" onclick="showChapter(11)">Chapter 11</div>
  <div id="tab12" class="chap-tab" onclick="showChapter(12)">Chapter 12</div>
  <div id="tabA"  class="chap-tab" onclick="showChapter('A')">Analyze Code</div>
</div>


<!-- ============================================================
   EXPLANATION POPUP (A2 style — below the hotspot)
============================================================ -->
<div id="explainPanel" class="popup-panel">
  <div id="explainText"></div>
</div>


<!-- ============================================================
   CHAPTER 9 SECTION
============================================================ -->
<div id="chapter9" class="chapter-section active-chap">

  <h1>Chapter 9 — Objects & Classes</h1>
  <p>Select an example to visualize the code with color roles + hotspot explanations:</p>

  <!-- CH9 EXAMPLE PICKER BUTTONS -->
  <div class="example-picker">
    <button class="ex9-btn" id="btn_CircleWithStatic" onclick="loadCH9Example('CircleWithStatic')">CircleWithStaticMembers</button>
    <button class="ex9-btn" id="btn_TV" onclick="loadCH9Example('TV')">TV Class</button>
    <button class="ex9-btn" id="btn_PassObject" onclick="loadCH9Example('PassObject')">TestPassObject</button>
  </div>

  <!-- CODE VIEW -->
  <div id="ex9Code" class="code-block">
    <!-- Filled by JS -->
  </div>

  <h2>Simulated Console Output:</h2>
  <pre id="ex9Console" class="console-block"></pre>

</div>


<!-- ============================================================
   CHAPTER 10 (placeholder — you already have content)
============================================================ -->
<div id="chapter10" class="chapter-section">
  <h1>Chapter 10 — Object-Oriented Thinking</h1>
  <p>This chapter tab will be filled with your interactive content, quiz buttons, and examples like Chapter 9.</p>
</div>


<!-- ============================================================
   CHAPTER 11 (placeholder — customizable)
============================================================ -->
<div id="chapter11" class="chapter-section">
  <h1>Chapter 11 — Inheritance & Polymorphism</h1>
  <p>Your full Chapter 11 interactive content goes here.</p>
</div>


<!-- ============================================================
   CHAPTER 12 (placeholder)
============================================================ -->
<div id="chapter12" class="chapter-section">
  <h1>Chapter 12 — Exception Handling</h1>
  <p>Chapter 12 content will go here.</p>
</div>


<!-- ============================================================
   CODE ANALYZER MODE
============================================================ -->
<div id="chapterA" class="chapter-section">
  <h1>Analyze Any Java Code</h1>

  <p>Paste Java code below, then click <b>Analyze Code</b> to get:</p>
  <ul>
    <li>Semantic color highlighting</li>
    <li>Class finder</li>
    <li>Constructor finder</li>
    <li>Field extractor</li>
    <li>new Object creation list</li>
  </ul>

  <textarea id="analyzeInput" placeholder="Paste Java code here..."></textarea>

  <button onclick="analyzeCode()">Analyze Code</button>

  <h2>Highlighted Code</h2>
  <div id="analyzeCodeView" class="code-block"></div>

  <h2>Structure Summary</h2>
  <div id="analyzeSummary"></div>
</div>


</body>
</html>


