<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Java Visualizer – Chapters 9–12</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA hooks (optional but nice on Android) -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4e6cff">

  <style>
    :root {
      --bg: #f3f4f9;
      --accent: #4e6cff;
      --code-bg: #1e1e1e;
      --console-bg: #000;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
                   "Segoe UI", Consolas, "Courier New", monospace;
      background: var(--bg);
      margin: 0;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    h1, h2 {
      text-align: center;
      margin: 4px 0;
    }

    h1 { font-size: 1.4rem; }
    h2 { font-size: 1.05rem; font-weight: 500; color: #333; }

    /* Top tab bar */
    .tab-bar {
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
      padding: 10px 8px 4px;
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(243,244,249,0.97);
      border-bottom: 1px solid #d0d2e0;
      backdrop-filter: blur(4px);
    }

    .chap-tab {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #555;
      font-size: 0.8rem;
      background: #fff;
      cursor: pointer;
    }
    .chap-tab.active {
      background: var(--accent);
      color: #fff;
    }

    /* Color legend */
    .legend {
      text-align: center;
      font-size: .75rem;
      margin: 4px 6px 10px;
    }
    .legend span {
      padding: 2px 6px;
      border-radius: 4px;
      margin: 2px;
      display: inline-block;
    }

    .field { background: rgba(0,200,255,.35); }
    .ctor  { background: rgba(0,255,0,.35); }
    .stat  { background: rgba(255,165,0,.35); }
    .thisc { background: rgba(255,0,255,.35); }
    .newc  { background: rgba(255,0,0,.35); }
    .inh   { background: rgba(155,89,182,.35); }
    .exc   { background: rgba(231,76,60,.35); }

    /* Chapter sections */
    .chapter-section {
      display: none;
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 16px 30px;
    }
    .active-chap {
      display: block;
      animation: fadeIn .25s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Code blocks */
    .code-block {
      background: var(--code-bg);
      color: #eaeaea;
      padding: 12px;
      border-radius: 10px;
      white-space: pre;
      overflow-x: auto;
      font-size: .82rem;
    }

    /* Console */
    .console-block {
      background: var(--console-bg);
      color: #00ff7f;
      padding: 10px;
      border-radius: 8px;
      white-space: pre;
      font-size: .8rem;
      min-height: 80px;
    }

    /* Buttons general */
    button {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #fff;
      cursor: pointer;
      font-size: 0.8rem;
    }
    button:hover { background: #ececec; }

    /* Example picker */
    .example-picker {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 8px;
    }
    .ex9-btn.active {
      background: var(--accent);
      color: #fff;
    }

    /* Two-column layout for steps/diagram and analyzer */
    .ex9-layout {
      display: grid;
      grid-template-columns: 1.25fr 1fr;
      gap: 14px;
      margin-top: 18px;
    }

    @media(max-width:800px) {
      .ex9-layout {
        grid-template-columns: 1fr;
      }
    }

    .ex-panel {
      background: #fff;
      border: 1px solid #ddd;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 0.85rem;
    }

    /* Explainable hotspots */
    .explainable {
      border-bottom: 1px dotted #ffd700;
      cursor: pointer;
    }

    .popup-panel {
      position: absolute;
      display: none;
      max-width: 280px;
      background: #fff;
      padding: 8px 10px;
      border-radius: 10px;
      font-size: .8rem;
      box-shadow: 0 2px 10px rgba(0,0,0,.25);
      z-index: 30;
    }

    /* Analyzer */
    #analyzeInput {
      width: 100%;
      min-height: 200px;
      font-family: Consolas, monospace;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: .85rem;
      box-sizing: border-box;
    }

    .analyzer-summary {
      padding: 8px 6px;
      background: #eef2ff;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: .85rem;
    }

    .analyzer-section-title {
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: 600;
      font-size: .85rem;
    }

    .analyzer-list {
      font-size: .82rem;
      padding-left: 18px;
    }

    /* Highlight classes for analyzer preview */
    .hl-field      { background: rgba(0,200,255,.35); }
    .hl-static     { background: rgba(255,165,0,.35); }
    .hl-new        { background: rgba(255,0,0,.35); }
    .hl-this       { background: rgba(255,0,255,.35); }
    .hl-inherit    { background: rgba(155,89,182,.35); }
    .hl-exception  { background: rgba(231,76,60,.35); }
  </style>
</head>

<body>

<!-- ============================================================
   TOP NAV TABS
============================================================ -->
<div class="tab-bar">
  <div id="tab9"  class="chap-tab active" onclick="showChapter(9)">Chapter 9</div>
  <div id="tab10" class="chap-tab" onclick="showChapter(10)">Chapter 10</div>
  <div id="tab11" class="chap-tab" onclick="showChapter(11)">Chapter 11</div>
  <div id="tab12" class="chap-tab" onclick="showChapter(12)">Chapter 12</div>
  <div id="tabA"  class="chap-tab" onclick="showChapter('A')">Analyze Code</div>
</div>

<!-- COLOR LEGEND -->
<div class="legend">
  <span class="field">Fields</span>
  <span class="ctor">Constructors</span>
  <span class="stat">Static (class-level)</span>
  <span class="thisc">this references</span>
  <span class="newc">new object creation</span>
  <span class="inh">Inheritance (extends / implements / super)</span>
  <span class="exc">Exceptions (try / catch / throw)</span>
</div>

<!-- EXPLANATION POPUP -->
<div id="explainPanel" class="popup-panel">
  <div id="explainText"></div>
</div>

<!-- ============================================================
   CHAPTER 9
============================================================ -->
<div id="chapter9" class="chapter-section active-chap">
  <h1>Chapter 9 — Objects &amp; Classes</h1>
  <p style="text-align:center;">
    Select an example to visualize the code with color roles, hotspots, and step-by-step execution.
  </p>

  <div class="example-picker">
    <button class="ex9-btn" id="btn_CircleWithStatic" onclick="loadCH9Example('CircleWithStatic')">
      CircleWithStaticMembers
    </button>
    <button class="ex9-btn" id="btn_TV" onclick="loadCH9Example('TV')">
      TV Class
    </button>
    <button class="ex9-btn" id="btn_PassObject" onclick="loadCH9Example('PassObject')">
      TestPassObject
    </button>
  </div>

  <div id="ex9Code" class="code-block">
    <!-- Filled by JS -->
  </div>

  <h2>Simulated Console Output</h2>
  <pre id="ex9Console" class="console-block"></pre>

  <h2>Execution Steps &amp; Memory Diagram</h2>
  <div class="ex9-layout">
    <div class="ex-panel">
      <div id="ex9StepText">(Select an example and click "Next Step".)</div>
      <div style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;">
        <button onclick="prevStep('9')">Previous Step</button>
        <button onclick="nextStep('9')">Next Step</button>
      </div>
    </div>
    <div class="ex-panel">
      <div id="ex9Diagram">(Memory diagram will appear here.)</div>
    </div>
  </div>
</div>

<!-- ============================================================
   CHAPTER 10 (placeholder, ready for future examples)
============================================================ -->
<div id="chapter10" class="chapter-section">
  <h1>Chapter 10 — Object-Oriented Thinking</h1>
  <p style="text-align:center;">
    This tab is ready for your Chapter 10 examples, code, and step-by-step visualizations.
  </p>
</div>

<!-- ============================================================
   CHAPTER 11 (placeholder)
============================================================ -->
<div id="chapter11" class="chapter-section">
  <h1>Chapter 11 — Inheritance &amp; Polymorphism</h1>
  <p style="text-align:center;">
    This tab is ready for your Chapter 11 examples and visual tools.
  </p>
</div>

<!-- ============================================================
   CHAPTER 12 (placeholder)
============================================================ -->
<div id="chapter12" class="chapter-section">
  <h1>Chapter 12 — Exception Handling</h1>
  <p style="text-align:center;">
    This tab is ready for your Chapter 12 examples and exception demos.
  </p>
</div>

<!-- ============================================================
   ANALYZE ANY CODE (Analyzer Mode)
============================================================ -->
<div id="chapterA" class="chapter-section">
  <h1>Analyze Any Java Code</h1>
  <p>
    Paste Java code below, then click <b>Analyze Code</b> to get a highlighted
    view and a structured breakdown (classes, fields, constructors, methods,
    static members, <code>new</code>, <code>this</code>, inheritance, exceptions).
  </p>

  <textarea id="analyzeInput" placeholder="Paste Java code here..."></textarea>
  <div style="margin-top:8px;">
    <button onclick="analyzePastedCode()">Analyze Code</button>
  </div>

  <div class="ex9-layout" style="margin-top:16px;">
    <div class="ex-panel">
      <h3>2. Highlighted code (by concept)</h3>
      <pre id="analyzeCodeView" class="code-block">
(Paste your code above and click "Analyze Code" to see color-coded highlights here.)</pre>
    </div>

    <div class="ex-panel">
      <h3>3. Structured breakdown</h3>
      <div id="analyzeSummary" class="analyzer-summary">
        (Nothing analyzed yet. Paste code and click “Analyze Code”.)
      </div>

      <div class="analyzer-section-title">Classes</div>
      <ul id="analyzeClasses" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Interfaces</div>
      <ul id="analyzeInterfaces" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Fields (instance or static)</div>
      <ul id="analyzeFields" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Constructors</div>
      <ul id="analyzeConstructors" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Methods</div>
      <ul id="analyzeMethods" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Static members (fields or methods)</div>
      <ul id="analyzeStatic" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Object creation (new)</div>
      <ul id="analyzeNew" class="analyzer-list"></ul>

      <div class="analyzer-section-title">this references</div>
      <ul id="analyzeThis" class="analyzer-list"></ul>

      <div class="analyzer-section-title">super / inheritance references</div>
      <ul id="analyzeSuper" class="analyzer-list"></ul>

      <div class="analyzer-section-title">extends / implements usage</div>
      <ul id="analyzeInherit" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Exceptions (try / catch / throw / throws)</div>
      <ul id="analyzeExceptions" class="analyzer-list"></ul>
    </div>
  </div>
</div>

<!-- ============================================================
   SCRIPTS
============================================================ -->
<script>
  // ------------------------------------------------------------
  // TAB SWITCHING (Ch 9–12 + Analyzer)
  // ------------------------------------------------------------
  function showChapter(ch) {
    document.querySelectorAll(".chap-tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".chapter-section").forEach(s => s.classList.remove("active-chap"));

    document.getElementById("tab" + ch).classList.add("active");
    const chapId = (ch === 'A') ? 'chapterA' : ('chapter' + ch);
    document.getElementById(chapId).classList.add("active-chap");
  }

  // ------------------------------------------------------------
  // HOTSPOTS (tap-to-explain)
  // ------------------------------------------------------------
  document.addEventListener("click", e => {
    const panel = document.getElementById("explainPanel");

    if (e.target.classList.contains("explainable")) {
      const msg = e.target.dataset.explain || "No explanation.";
      const rect = e.target.getBoundingClientRect();

      document.getElementById("explainText").textContent = msg;
      panel.style.display = "block";

      // Position just below tapped word
      panel.style.left = rect.left + "px";
      panel.style.top = (rect.bottom + window.scrollY + 4) + "px";
    } else if (!panel.contains(e.target)) {
      panel.style.display = "none";
    }
  });

  // ------------------------------------------------------------
  // CHAPTER 9 EXAMPLE DATA (code + console + steps + diagram)
  // ------------------------------------------------------------
  const chapter9Examples = {
    "CircleWithStatic": {
      title: "CircleWithStaticMembers.java",
      code: `
public class <span class="stat explainable" data-explain="Static field shared across ALL objects">CircleWithStaticMembers</span> {
  double <span class="field explainable" data-explain="Instance field — each object gets its own radius">radius</span>;
  static int <span class="stat explainable" data-explain="Counts how many Circle objects have ever been created">numberOfObjects</span> = 0;

  <span class="ctor explainable" data-explain="Constructor with no parameters">CircleWithStaticMembers</span>() {
    <span class="thisc explainable" data-explain="Refers to the object's own instance field">radius</span> = 1.0;
    numberOfObjects++;
  }

  <span class="ctor explainable" data-explain="Constructor with one parameter">CircleWithStaticMembers</span>(double newRadius) {
    radius = newRadius;
    numberOfObjects++;
  }

  static int <span class="stat explainable" data-explain="Static method called on the class, not on an object">getNumberOfObjects</span>() {
    return numberOfObjects;
  }

  double getArea() {
    return radius * radius * Math.PI;
  }
}
`,
      console: `Before creating objects
The number of Circle objects is 0

After creating c1
c1: radius (1.0) and numberOfObjects (1)

After creating c2 and modifying c1
c1: radius (9.0) and numberOfObjects (2)
c2: radius (5.0) and numberOfObjects (2)`,
      steps: [
        "1. Program starts in main() of TestCircleWithStaticMembers.",
        "2. Before creating any objects, the static field numberOfObjects is 0.",
        "3. The statement 'CircleWithStaticMembers c1 = new CircleWithStaticMembers();' creates the first object.",
        "4. The no-arg constructor runs, sets radius = 1.0, and increments numberOfObjects to 1.",
        "5. The program prints c1’s radius and the static counter (which is 1).",
        "6. Then 'CircleWithStaticMembers c2 = new CircleWithStaticMembers(5);' creates a second object.",
        "7. The constructor with a parameter sets c2.radius = 5.0 and increments numberOfObjects to 2.",
        "8. The code changes c1.radius = 9.0 (only c1’s radius, not c2’s).",
        "9. Both c1 and c2 now see numberOfObjects == 2, because that field is shared by the class."
      ],
      diagram: `<pre>Stack
  c1 → obj#1 (CircleWithStaticMembers)
  c2 → obj#2 (CircleWithStaticMembers)

Heap
  obj#1: radius = 9.0
  obj#2: radius = 5.0

Static Area (shared by the class)
  CircleWithStaticMembers.numberOfObjects = 2</pre>`
    },

    "TV": {
      title: "TV.java",
      code: `
public class <span class="explainable" data-explain="A simple class modeling a TV">TV</span> {
  int <span class="field explainable" data-explain="Channel number">channel</span> = 1;
  int <span class="field explainable" data-explain="Volume level">volumeLevel</span> = 1;
  boolean <span class="field explainable" data-explain="Power state">on</span> = false;

  <span class="ctor explainable" data-explain="Constructor — creates a TV">TV</span>() {}

  void <span class="explainable" data-explain="Turns the TV on">turnOn</span>() {
    on = true;
  }

  void <span class="explainable" data-explain="Turns the TV off">turnOff</span>() {
    on = false;
  }

  void <span class="explainable" data-explain="Sets the channel if the TV is on">setChannel</span>(int newChannel) {
    if (on && newChannel >= 1 && newChannel <= 120)
      channel = newChannel;
  }
}
`,
      console: `TV on...
Channel set to 25`,
      steps: [
        "1. A TV object is created; channel = 1, volumeLevel = 1, on = false by default.",
        "2. When turnOn() is called, the on field becomes true.",
        "3. setChannel(25) checks that the TV is on and that 25 is between 1 and 120.",
        "4. Because both conditions are true, channel is updated to 25.",
        "5. If on were false or the channel were invalid, channel would not change."
      ],
      diagram: `<pre>Stack
  myTV → obj#1 (TV)

Heap
  obj#1:
    channel      = 25
    volumeLevel  = 1
    on           = true</pre>`
    },

    "PassObject": {
      title: "TestPassObject.java",
      code: `
public class TestPassObject {
  public static void main(String[] args) {
    <span class="field explainable" data-explain="c references a Circle object">Circle c</span> = 
      <span class="newc explainable" data-explain="Creates an object in the heap">new</span> Circle(1);

    <span class="explainable" data-explain="Method receives object reference (not a copy of the object)">printArea</span>(c);

    <span class="explainable" data-explain="Modifies the actual Circle object">c.radius</span> = 10;

    printArea(c);
  }

  public static void printArea(Circle c) {
    System.out.println("Radius = " + c.radius);
  }
}
`,
      console: `Radius = 1
Radius = 10`,
      steps: [
        "1. main() starts and creates a Circle object with radius 1; c points to that object.",
        "2. printArea(c) is called; the parameter c still points to the same Circle object.",
        "3. printArea prints the radius field of that object: 1.",
        "4. Back in main, c.radius = 10 changes the radius stored inside that same object.",
        "5. Calling printArea(c) again prints the updated radius 10.",
        "6. This shows that methods can modify the same object when passed a reference."
      ],
      diagram: `<pre>Stack
  main():
    c → obj#1 (Circle)
  printArea():
    c → obj#1 (same Circle)

Heap
  obj#1:
    radius = 10</pre>`
    }
  };

  // ------------------------------------------------------------
  // EXECUTION STEPPER (used for Chapter 9, easy to reuse later)
  // ------------------------------------------------------------
  let currentSteps = [];
  let currentStepIndex = 0;

  function setStepsForExample(steps, diagramHtml, chapterPrefix) {
    currentSteps = steps || [];
    currentStepIndex = 0;

    const diagramEl = document.getElementById(`ex${chapterPrefix}Diagram`);
    if (diagramEl) {
      diagramEl.innerHTML = diagramHtml || "(No diagram yet.)";
    }
    updateStepText(chapterPrefix);
  }

  function updateStepText(chapterPrefix) {
    const stepEl = document.getElementById(`ex${chapterPrefix}StepText`);
    if (!stepEl) return;

    if (!currentSteps.length) {
      stepEl.textContent = "(No step-by-step explanation provided for this example.)";
    } else {
      stepEl.textContent = currentSteps[currentStepIndex];
    }
  }

  function nextStep(chapterPrefix) {
    if (!currentSteps.length) return;
    currentStepIndex = (currentStepIndex + 1) % currentSteps.length;
    updateStepText(chapterPrefix);
  }

  function prevStep(chapterPrefix) {
    if (!currentSteps.length) return;
    currentStepIndex = (currentStepIndex - 1 + currentSteps.length) % currentSteps.length;
    updateStepText(chapterPrefix);
  }

  // ------------------------------------------------------------
  // LOAD A CHAPTER 9 EXAMPLE
  // ------------------------------------------------------------
  function loadCH9Example(key) {
    document.querySelectorAll(".ex9-btn").forEach(b => b.classList.remove("active"));
    document.getElementById("btn_" + key).classList.add("active");

    const ex = chapter9Examples[key];

    document.getElementById("ex9Code").innerHTML = ex.code;
    document.getElementById("ex9Console").textContent = ex.console;

    // Initialize steps + diagram for chapter 9 ("9" prefix)
    setStepsForExample(ex.steps, ex.diagram, "9");

    // Scroll into view (helpful on mobile)
    document.getElementById("chapter9").scrollIntoView({ behavior: "smooth" });
  }

  // ------------------------------------------------------------
  // ANALYZER: Highlight + Structured Breakdown
  // ------------------------------------------------------------
  function analyzePastedCode() {
    const src = document.getElementById("analyzeInput").value || "";
    const lines = src.split(/\r?\n/);

    const classes = [];
    const interfaces = [];
    const fields = [];
    const constructors = [];
    const methods = [];
    const staticMembers = [];
    const news = [];
    const thisRefs = [];
    const superRefs = [];
    const inheritanceInfo = [];
    const exceptions = [];

    let currentClass = null;

    const stripComments = (line) =>
      line.replace(/\/\/.*$/, "").replace(/\/\*.*\*\//g, "");

    // For highlighted code view
    const escapeHtml = (s) =>
      s.replace(/&/g, "&amp;")
       .replace(/</g, "&lt;")
       .replace(/>/g, "&gt;");

    const highlightedLines = [];

    lines.forEach((rawLine, idx) => {
      const lineNo = idx + 1;
      let line = stripComments(rawLine).trim();

      // ----- ANALYSIS (lists) -----
      if (line) {
        let m;

        // class / interface
        if ((m = line.match(/\bclass\s+([A-Za-z_]\w*)/))) {
          const name = m[1];
          currentClass = name;
          let extendsMatch = line.match(/\bextends\s+([A-Za-z_]\w*)/);
          let implementsMatch = line.match(/\bimplements\s+([A-Za-z_][\w,\s]*)/);
          let info = `class ${name}`;
          if (extendsMatch) info += ` extends ${extendsMatch[1]}`;
          if (implementsMatch) info += ` implements ${implementsMatch[1].trim()}`;
          classes.push(`${info}  (line ${lineNo})`);
          if (extendsMatch || implementsMatch) {
            inheritanceInfo.push(`${info}  (line ${lineNo})`);
          }
        } else if ((m = line.match(/\binterface\s+([A-Za-z_]\w*)/))) {
          interfaces.push(`interface ${m[1]}  (line ${lineNo})`);
        }

        // 'new' expressions
        if (line.includes(" new ")) {
          news.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // 'this' and 'super'
        if (line.includes("this.")) {
          thisRefs.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }
        if (line.includes("super")) {
          superRefs.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // inheritance keywords in non-class lines
        if (/\bextends\b|\bimplements\b/.test(line)) {
          inheritanceInfo.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // exceptions
        if (/\btry\b/.test(line) || /\bcatch\b/.test(line) ||
            /\bthrow\b/.test(line) || /\bthrows\b/.test(line)) {
          exceptions.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // skip obvious control-flow statements from method detection
        const controlKeywords = ["if ", "for ", "while ", "switch ", "catch ", "try ", "do "];
        const isControl = controlKeywords.some(kw =>
          line.startsWith(kw) || line.startsWith(kw.trim() + "(")
        );

        // methods / constructors heuristic
        if (!isControl && /\w+\s*\(.*\)\s*[{;]?$/.test(line)) {
          const sig = line.replace(/{.*$/, "").trim();
          const parts = sig.split(/\s+/);
          const parenIndex = sig.indexOf("(");
          const beforeParen = sig.substring(0, parenIndex).trim();
          const nameMatch = beforeParen.match(/([A-Za-z_]\w*)$/);
          const name = nameMatch ? nameMatch[1] : null;

          if (name) {
            if (currentClass && name === currentClass) {
              constructors.push(`Constructor: ${sig}  (line ${lineNo})`);
            } else {
              let returnType = "unknown";
              if (parts.length >= 2) {
                returnType = parts[parts.length - 2];
              }
              methods.push(`Method: ${name}  → returns ${returnType}  (line ${lineNo})`);
            }

            if (sig.includes(" static ")) {
              staticMembers.push(`"${rawLine.trim()}"  (line ${lineNo})`);
            }
          }
        }

        // fields (very rough)
        if (line.endsWith(";") && !line.includes("(") && !line.includes(")") &&
            !line.includes(" class ") && !line.startsWith("class ") &&
            !line.includes(" interface ") && !line.startsWith("interface ") &&
            !line.startsWith("import ") && !line.startsWith("package ")) {
          fields.push(`${line.replace(/;/, "").trim()}  (line ${lineNo})`);
          if (/\bstatic\b/.test(line)) {
            staticMembers.push(`"${rawLine.trim()}"  (line ${lineNo})`);
          }
        }
      }

      // ----- HIGHLIGHTED CODE VIEW -----
      let h = escapeHtml(rawLine);

      // simple keyword-based coloring
      h = h.replace(/\bstatic\b/g,
        '<span class="hl-static">static</span>');
      h = h.replace(/\bnew\b/g,
        '<span class="hl-new">new</span>');
      h = h.replace(/\bthis\b/g,
        '<span class="hl-this">this</span>');
      h = h.replace(/\bextends\b|\bimplements\b/g,
        '<span class="hl-inherit">$&</span>');
      h = h.replace(/\bsuper\b/g,
        '<span class="hl-inherit">super</span>');
      h = h.replace(/\btry\b|\bcatch\b|\bthrow\b|\bthrows\b/g,
        '<span class="hl-exception">$&</span>');

      // crude field highlight: lines that look like declarations and not methods
      if (/\b(int|double|boolean|char|String|long|float|short|byte)\b/.test(rawLine) &&
          rawLine.includes(";") && !rawLine.includes("(")) {
        h = '<span class="hl-field">' + h + '</span>';
      }

      highlightedLines.push(h);
    });

    // Put highlighted code into the preview panel
    const codeViewEl = document.getElementById("analyzeCodeView");
    codeViewEl.innerHTML = highlightedLines.join("\n");

    // ----- Fill the structured breakdown lists -----
    const summaryEl = document.getElementById("analyzeSummary");
    const outClasses = document.getElementById("analyzeClasses");
    const outInterfaces = document.getElementById("analyzeInterfaces");
    const outFields = document.getElementById("analyzeFields");
    const outCtors = document.getElementById("analyzeConstructors");
    const outMethods = document.getElementById("analyzeMethods");
    const outStatic = document.getElementById("analyzeStatic");
    const outNew = document.getElementById("analyzeNew");
    const outThis = document.getElementById("analyzeThis");
    const outSuper = document.getElementById("analyzeSuper");
    const outInherit = document.getElementById("analyzeInherit");
    const outExc = document.getElementById("analyzeExceptions");

    function fillList(listEl, arr) {
      listEl.innerHTML = "";
      if (!arr.length) {
        const li = document.createElement("li");
        li.textContent = "(none detected)";
        listEl.appendChild(li);
      } else {
        arr.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          listEl.appendChild(li);
        });
      }
    }

    const totalClasses = classes.length;
    const totalInterfaces = interfaces.length;
    const totalFields = fields.length;
    const totalMethods = methods.length;
    const totalCtors = constructors.length;

    summaryEl.textContent =
      `Detected ${totalClasses} class(es), ${totalInterfaces} interface(s), `
      + `${totalFields} field(s), ${totalCtors} constructor(s), ${totalMethods} method(s).`;

    fillList(outClasses, classes);
    fillList(outInterfaces, interfaces);
    fillList(outFields, fields);
    fillList(outCtors, constructors);
    fillList(outMethods, methods);
    fillList(outStatic, staticMembers);
    fillList(outNew, news);
    fillList(outThis, thisRefs);
    fillList(outSuper, superRefs);
    fillList(outInherit, inheritanceInfo);
    fillList(outExc, exceptions);
  }

  // ------------------------------------------------------------
  // INITIALIZE DEFAULT CH9 EXAMPLE
  // ------------------------------------------------------------
  window.addEventListener("DOMContentLoaded", () => {
    loadCH9Example("CircleWithStatic");
  });

  // ------------------------------------------------------------
  // OPTIONAL: SERVICE WORKER REGISTRATION (for PWA)
  // ------------------------------------------------------------
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(err => {
      console.log('Service worker registration failed:', err);
    });
  }
</script>

</body>
</html>
