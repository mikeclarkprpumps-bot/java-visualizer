<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Java Visualizer – Chapters 9–12</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA hooks (optional but nice on Android) -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4e6cff">

  <style>
    :root {
      --bg: #f3f4f9;
      --accent: #4e6cff;
      --code-bg: #1e1e1e;
      --console-bg: #000;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
                   "Segoe UI", Consolas, "Courier New", monospace;
      background: var(--bg);
      margin: 0;
    }

    h1, h2 {
      text-align: center;
      margin: 4px 0;
    }

    h1 { font-size: 1.4rem; }
    h2 { font-size: 1.05rem; font-weight: 500; color: #333; }

    /* Top tab bar */
    .tab-bar {
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
      padding: 10px 8px 4px;
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(243,244,249,0.97);
      border-bottom: 1px solid #d0d2e0;
      backdrop-filter: blur(4px);
    }

    .chap-tab {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #555;
      font-size: 0.8rem;
      background: #fff;
      cursor: pointer;
    }
    .chap-tab.active {
      background: var(--accent);
      color: #fff;
    }

    /* Color legend */
    .legend {
      text-align: center;
      font-size: .75rem;
      margin: 4px 6px 10px;
    }
    .legend span {
      padding: 2px 6px;
      border-radius: 4px;
      margin: 2px;
      display: inline-block;
    }

    .field { background: rgba(0,200,255,.35); }
    .ctor  { background: rgba(0,255,0,.35); }
    .stat  { background: rgba(255,165,0,.35); }
    .thisc { background: rgba(255,0,255,.35); }
    .newc  { background: rgba(255,0,0,.35); }
    .inh   { background: rgba(155,89,182,.35); }
    .exc   { background: rgba(231,76,60,.35); }

    /* Chapter sections */
    .chapter-section {
      display: none;
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 16px 30px;
    }
    .active-chap {
      display: block;
      animation: fadeIn .25s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Code blocks */
    .code-block {
      background: var(--code-bg);
      color: #eaeaea;
      padding: 12px;
      border-radius: 10px;
      white-space: pre;
      overflow-x: auto;
      font-size: .82rem;
    }

    /* Console */
    .console-block {
      background: var(--console-bg);
      color: #00ff7f;
      padding: 10px;
      border-radius: 8px;
      white-space: pre;
      font-size: .8rem;
      min-height: 80px;
    }

    /* Buttons general */
    button {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #fff;
      cursor: pointer;
      font-size: 0.8rem;
    }
    button:hover { background: #ececec; }

    /* Example pickers */
    .example-picker {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 8px;
    }
    .ex9-btn.active,
    .ex10-btn.active {
      background: var(--accent);
      color: #fff;
    }

    /* Layout for steps/diagram and analyzer */
    .two-col-layout {
      display: grid;
      grid-template-columns: 1.25fr 1fr;
      gap: 14px;
      margin-top: 18px;
    }

    @media(max-width:800px) {
      .two-col-layout {
        grid-template-columns: 1fr;
      }
    }

    .ex-panel {
      background: #fff;
      border: 1px solid #ddd;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 0.85rem;
    }

    /* Multi-code layout for Chapter 10 */
    .code-grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media(max-width:900px) {
      .code-grid-2 {
        grid-template-columns: 1fr;
      }
    }

    /* Explainable hotspots */
    .explainable {
      border-bottom: 1px dotted #ffd700;
      cursor: pointer;
    }

    .popup-panel {
      position: absolute;
      display: none;
      max-width: 280px;
      background: #fff;
      padding: 8px 10px;
      border-radius: 10px;
      font-size: .8rem;
      box-shadow: 0 2px 10px rgba(0,0,0,.25);
      z-index: 30;
    }

    /* Analyzer */
    #analyzeInput {
      width: 100%;
      min-height: 200px;
      font-family: Consolas, monospace;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: .85rem;
      box-sizing: border-box;
    }

    .analyzer-summary {
      padding: 8px 6px;
      background: #eef2ff;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: .85rem;
    }

    .analyzer-section-title {
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: 600;
      font-size: .85rem;
    }

    .analyzer-list {
      font-size: .82rem;
      padding-left: 18px;
    }

    /* Highlight classes for analyzer preview */
    .hl-field      { background: rgba(0,200,255,.35); }
    .hl-static     { background: rgba(255,165,0,.35); }
    .hl-new        { background: rgba(255,0,0,.35); }
    .hl-this       { background: rgba(255,0,255,.35); }
    .hl-inherit    { background: rgba(155,89,182,.35); }
    .hl-exception  { background: rgba(231,76,60,.35); }
  </style>
</head>

<body>

<!-- ============================================================
   TOP NAV TABS
============================================================ -->
<div class="tab-bar">
  <div id="tab9"  class="chap-tab active" onclick="showChapter(9)">Chapter 9</div>
  <div id="tab10" class="chap-tab" onclick="showChapter(10)">Chapter 10</div>
  <div id="tab11" class="chap-tab" onclick="showChapter(11)">Chapter 11</div>
  <div id="tab12" class="chap-tab" onclick="showChapter(12)">Chapter 12</div>
  <div id="tabA"  class="chap-tab" onclick="showChapter('A')">Analyze Code</div>
</div>

<!-- COLOR LEGEND -->
<div class="legend">
  <span class="field">Fields</span>
  <span class="ctor">Constructors</span>
  <span class="stat">Static (class-level)</span>
  <span class="thisc">this references</span>
  <span class="newc">new object creation</span>
  <span class="inh">Inheritance / super</span>
  <span class="exc">Exceptions</span>
</div>

<!-- EXPLANATION POPUP -->
<div id="explainPanel" class="popup-panel">
  <div id="explainText"></div>
</div>

<!-- ============================================================
   CHAPTER 9
============================================================ -->
<div id="chapter9" class="chapter-section active-chap">
  <h1>Chapter 9 — Objects &amp; Classes</h1>
  <p style="text-align:center;">
    Select an example to visualize the code with color roles, hotspots, and step-by-step execution.
  </p>

  <div class="example-picker">
    <button class="ex9-btn" id="btn_CircleWithStatic" onclick="loadCH9Example('CircleWithStatic')">
      CircleWithStaticMembers
    </button>
    <button class="ex9-btn" id="btn_TV" onclick="loadCH9Example('TV')">
      TV Class
    </button>
    <button class="ex9-btn" id="btn_PassObject" onclick="loadCH9Example('PassObject')">
      TestPassObject
    </button>
  </div>

  <div id="ex9Code" class="code-block">
    <!-- Filled by JS -->
  </div>

  <h2>Simulated Console Output</h2>
  <pre id="ex9Console" class="console-block"></pre>

  <h2>Execution Steps &amp; Memory Diagram</h2>
  <div class="two-col-layout">
    <div class="ex-panel">
      <div id="ex9StepText">(Select an example and click "Next Step".)</div>
      <div style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;">
        <button onclick="prevStep('9')">Previous Step</button>
        <button onclick="nextStep('9')">Next Step</button>
      </div>
    </div>
    <div class="ex-panel">
      <div id="ex9Diagram">(Memory diagram will appear here.)</div>
    </div>
  </div>
</div>

<!-- ============================================================
   CHAPTER 10 — FULLY WIRED
============================================================ -->
<div id="chapter10" class="chapter-section">
  <h1>Chapter 10 — Object-Oriented Thinking</h1>
  <p style="text-align:center;">
    Choose a test program. The Visualizer automatically pairs it with its core class and
    shows both code files, simulated output, and a memory diagram.
  </p>

  <div class="example-picker">
    <button class="ex10-btn" id="btn10_Loan" onclick="loadCH10Example('Loan')">
      Loan / TestLoanClass
    </button>
    <button class="ex10-btn" id="btn10_BMI" onclick="loadCH10Example('BMI')">
      BMI / UseBMIClass
    </button>
    <button class="ex10-btn" id="btn10_Course" onclick="loadCH10Example('Course')">
      Course / TestCourse
    </button>
    <button class="ex10-btn" id="btn10_Stack" onclick="loadCH10Example('Stack')">
      StackOfIntegers / TestStackOfIntegers
    </button>
    <button class="ex10-btn" id="btn10_Palindrome" onclick="loadCH10Example('Palindrome')">
      PalindromeIgnoreNonAlphanumeric
    </button>
    <button class="ex10-btn" id="btn10_LargeFact" onclick="loadCH10Example('LargeFact')">
      LargeFactorial
    </button>
  </div>

  <!-- Core class + Test class side by side -->
  <div class="code-grid-2">
    <div>
      <h2 style="text-align:left; font-size:.9rem;">Core Class</h2>
      <div id="ex10CoreCode" class="code-block"></div>
    </div>
    <div>
      <h2 style="text-align:left; font-size:.9rem;">Test / Driver</h2>
      <div id="ex10TestCode" class="code-block"></div>
    </div>
  </div>

  <h2>Simulated Console Output</h2>
  <pre id="ex10Console" class="console-block"></pre>

  <h2>Execution Steps &amp; Memory Diagram</h2>
  <div class="two-col-layout">
    <div class="ex-panel">
      <div id="ex10StepText">(Select an example and click "Next Step".)</div>
      <div style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;">
        <button onclick="prevStep('10')">Previous Step</button>
        <button onclick="nextStep('10')">Next Step</button>
      </div>
    </div>
    <div class="ex-panel">
      <div id="ex10Diagram">(Memory diagram will appear here.)</div>
    </div>
  </div>
</div>

<!-- ============================================================
   CHAPTER 11 (placeholder)
============================================================ -->
<div id="chapter11" class="chapter-section">
  <h1>Chapter 11 — Inheritance &amp; Polymorphism</h1>
  <p style="text-align:center;">
    This tab is ready for your Chapter 11 examples and visual tools.
  </p>
</div>

<!-- ============================================================
   CHAPTER 12 (placeholder)
============================================================ -->
<div id="chapter12" class="chapter-section">
  <h1>Chapter 12 — Exception Handling</h1>
  <p style="text-align:center;">
    This tab is ready for your Chapter 12 examples and exception demos.
  </p>
</div>

<!-- ============================================================
   ANALYZE ANY CODE (Analyzer Mode)
============================================================ -->
<div id="chapterA" class="chapter-section">
  <h1>Analyze Any Java Code</h1>
  <p>
    Paste Java code below, then click <b>Analyze Code</b> to get a highlighted
    view and a structured breakdown (classes, fields, constructors, methods,
    static members, <code>new</code>, <code>this</code>, inheritance, exceptions).
  </p>

  <textarea id="analyzeInput" placeholder="Paste Java code here..."></textarea>
  <div style="margin-top:8px;">
    <button onclick="analyzePastedCode()">Analyze Code</button>
  </div>

  <div class="two-col-layout" style="margin-top:16px;">
    <div class="ex-panel">
      <h3>2. Highlighted code (by concept)</h3>
      <pre id="analyzeCodeView" class="code-block">
(Paste your code above and click "Analyze Code" to see color-coded highlights here.)</pre>
    </div>

    <div class="ex-panel">
      <h3>3. Structured breakdown</h3>
      <div id="analyzeSummary" class="analyzer-summary">
        (Nothing analyzed yet. Paste code and click “Analyze Code”.)
      </div>

      <div class="analyzer-section-title">Classes</div>
      <ul id="analyzeClasses" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Interfaces</div>
      <ul id="analyzeInterfaces" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Fields (instance or static)</div>
      <ul id="analyzeFields" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Constructors</div>
      <ul id="analyzeConstructors" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Methods</div>
      <ul id="analyzeMethods" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Static members (fields or methods)</div>
      <ul id="analyzeStatic" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Object creation (new)</div>
      <ul id="analyzeNew" class="analyzer-list"></ul>

      <div class="analyzer-section-title">this references</div>
      <ul id="analyzeThis" class="analyzer-list"></ul>

      <div class="analyzer-section-title">super / inheritance references</div>
      <ul id="analyzeSuper" class="analyzer-list"></ul>

      <div class="analyzer-section-title">extends / implements usage</div>
      <ul id="analyzeInherit" class="analyzer-list"></ul>

      <div class="analyzer-section-title">Exceptions (try / catch / throw / throws)</div>
      <ul id="analyzeExceptions" class="analyzer-list"></ul>
    </div>
  </div>
</div>

<!-- ============================================================
   SCRIPTS
============================================================ -->
<script>
  // ------------------------------------------------------------
  // TAB SWITCHING (Ch 9–12 + Analyzer)
  // ------------------------------------------------------------
  function showChapter(ch) {
    document.querySelectorAll(".chap-tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".chapter-section").forEach(s => s.classList.remove("active-chap"));

    document.getElementById("tab" + ch).classList.add("active");
    const chapId = (ch === 'A') ? 'chapterA' : ('chapter' + ch);
    document.getElementById(chapId).classList.add("active-chap");
  }

  // ------------------------------------------------------------
  // HOTSPOTS (tap-to-explain)
  // ------------------------------------------------------------
  document.addEventListener("click", e => {
    const panel = document.getElementById("explainPanel");

    if (e.target.classList.contains("explainable")) {
      const msg = e.target.dataset.explain || "No explanation.";
      const rect = e.target.getBoundingClientRect();

      document.getElementById("explainText").textContent = msg;
      panel.style.display = "block";

      // Position just below tapped word
      panel.style.left = rect.left + "px";
      panel.style.top = (rect.bottom + window.scrollY + 4) + "px";
    } else if (!panel.contains(e.target)) {
      panel.style.display = "none";
    }
  });

  // ------------------------------------------------------------
  // CHAPTER 9 EXAMPLE DATA (code + console + steps + diagram)
  // ------------------------------------------------------------
  const chapter9Examples = {
    "CircleWithStatic": {
      title: "CircleWithStaticMembers.java",
      code: `
public class <span class="stat explainable" data-explain="Static field shared across ALL objects">CircleWithStaticMembers</span> {
  double <span class="field explainable" data-explain="Instance field — each object gets its own radius">radius</span>;
  static int <span class="stat explainable" data-explain="Counts how many Circle objects have ever been created">numberOfObjects</span> = 0;

  <span class="ctor explainable" data-explain="Constructor with no parameters">CircleWithStaticMembers</span>() {
    <span class="thisc explainable" data-explain="Refers to the object's own instance field">radius</span> = 1.0;
    numberOfObjects++;
  }

  <span class="ctor explainable" data-explain="Constructor with one parameter">CircleWithStaticMembers</span>(double newRadius) {
    radius = newRadius;
    numberOfObjects++;
  }

  static int <span class="stat explainable" data-explain="Static method called on the class, not on an object">getNumberOfObjects</span>() {
    return numberOfObjects;
  }

  double getArea() {
    return radius * radius * Math.PI;
  }
}
`,
      console: `Before creating objects
The number of Circle objects is 0

After creating c1
c1: radius (1.0) and numberOfObjects (1)

After creating c2 and modifying c1
c1: radius (9.0) and numberOfObjects (2)
c2: radius (5.0) and numberOfObjects (2)`,
      steps: [
        "1. Program starts in main() of TestCircleWithStaticMembers.",
        "2. Before creating any objects, the static field numberOfObjects is 0.",
        "3. The statement 'CircleWithStaticMembers c1 = new CircleWithStaticMembers();' creates the first object.",
        "4. The no-arg constructor runs, sets radius = 1.0, and increments numberOfObjects to 1.",
        "5. The program prints c1’s radius and the static counter (which is 1).",
        "6. Then 'CircleWithStaticMembers c2 = new CircleWithStaticMembers(5);' creates a second object.",
        "7. The constructor with a parameter sets c2.radius = 5.0 and increments numberOfObjects to 2.",
        "8. The code changes c1.radius = 9.0 (only c1’s radius, not c2’s).",
        "9. Both c1 and c2 now see numberOfObjects == 2, because that field is shared by the class."
      ],
      diagram: `<pre>Stack
  c1 → obj#1 (CircleWithStaticMembers)
  c2 → obj#2 (CircleWithStaticMembers)

Heap
  obj#1: radius = 9.0
  obj#2: radius = 5.0

Static Area (shared by the class)
  CircleWithStaticMembers.numberOfObjects = 2</pre>`
    },

    "TV": {
      title: "TV.java",
      code: `
public class <span class="explainable" data-explain="A simple class modeling a TV">TV</span> {
  int <span class="field explainable" data-explain="Channel number">channel</span> = 1;
  int <span class="field explainable" data-explain="Volume level">volumeLevel</span> = 1;
  boolean <span class="field explainable" data-explain="Power state">on</span> = false;

  <span class="ctor explainable" data-explain="Constructor — creates a TV">TV</span>() {}

  void <span class="explainable" data-explain="Turns the TV on">turnOn</span>() {
    on = true;
  }

  void <span class="explainable" data-explain="Turns the TV off">turnOff</span>() {
    on = false;
  }

  void <span class="explainable" data-explain="Sets the channel if the TV is on">setChannel</span>(int newChannel) {
    if (on && newChannel >= 1 && newChannel <= 120)
      channel = newChannel;
  }
}
`,
      console: `TV on...
Channel set to 25`,
      steps: [
        "1. A TV object is created; channel = 1, volumeLevel = 1, on = false by default.",
        "2. When turnOn() is called, the on field becomes true.",
        "3. setChannel(25) checks that the TV is on and that 25 is between 1 and 120.",
        "4. Because both conditions are true, channel is updated to 25.",
        "5. If on were false or the channel were invalid, channel would not change."
      ],
      diagram: `<pre>Stack
  myTV → obj#1 (TV)

Heap
  obj#1:
    channel      = 25
    volumeLevel  = 1
    on           = true</pre>`
    },

    "PassObject": {
      title: "TestPassObject.java",
      code: `
public class TestPassObject {
  public static void main(String[] args) {
    <span class="field explainable" data-explain="c references a Circle object">Circle c</span> = 
      <span class="newc explainable" data-explain="Creates an object in the heap">new</span> Circle(1);

    <span class="explainable" data-explain="Method receives object reference (not a copy of the object)">printArea</span>(c);

    <span class="explainable" data-explain="Modifies the actual Circle object">c.radius</span> = 10;

    printArea(c);
  }

  public static void printArea(Circle c) {
    System.out.println("Radius = " + c.radius);
  }
}
`,
      console: `Radius = 1
Radius = 10`,
      steps: [
        "1. main() starts and creates a Circle object with radius 1; c points to that object.",
        "2. printArea(c) is called; the parameter c still points to the same Circle object.",
        "3. printArea prints the radius field of that object: 1.",
        "4. Back in main, c.radius = 10 changes the radius stored inside that same object.",
        "5. Calling printArea(c) again prints the updated radius 10.",
        "6. This shows that methods can modify the same object when passed a reference."
      ],
      diagram: `<pre>Stack
  main():
    c → obj#1 (Circle)
  printArea():
    c → obj#1 (same Circle)

Heap
  obj#1:
    radius = 10</pre>`
    }
  };

  // ------------------------------------------------------------
  // CHAPTER 10 EXAMPLES (paired core + test)
  // ------------------------------------------------------------
  const chapter10Examples = {
    "Loan": {
      coreTitle: "Loan.java",
      coreCode: `
public class Loan {
  private double <span class="field explainable" data-explain="Annual percentage interest rate, e.g., 8.25%">annualInterestRate</span>;
  private int <span class="field explainable" data-explain="Length of the loan in years">numberOfYears</span>;
  private double <span class="field explainable" data-explain="Principal borrowed">loanAmount</span>;
  private java.util.Date <span class="field explainable" data-explain="When this Loan object was created">loanDate</span>;

  <span class="ctor explainable" data-explain="Default constructor delegates to the full constructor">public Loan()</span> {
    this(2.5, 1, 1000);
  }

  <span class="ctor explainable" data-explain="Construct a loan with interest, years, and amount">public Loan</span>(
      double annualInterestRate, int numberOfYears, double loanAmount) {
    this.annualInterestRate = annualInterestRate;
    this.numberOfYears = numberOfYears;
    this.loanAmount = loanAmount;
    loanDate = new java.util.Date();
  }

  public double getAnnualInterestRate() { return annualInterestRate; }
  public int getNumberOfYears() { return numberOfYears; }
  public double getLoanAmount() { return loanAmount; }
  public java.util.Date getLoanDate() { return loanDate; }

  /** Monthly payment using amortization formula */
  public double getMonthlyPayment() {
    double monthlyInterestRate = annualInterestRate / 1200;
    double monthlyPayment = loanAmount * monthlyInterestRate /
      (1 - 1 / Math.pow(1 + monthlyInterestRate, numberOfYears * 12));
    return monthlyPayment;
  }

  public double getTotalPayment() {
    return getMonthlyPayment() * numberOfYears * 12;
  }
}
`,
      testTitle: "TestLoanClass.java",
      testCode: `
public class TestLoanClass {
  public static void main(String[] args) {
    java.util.Scanner input = new java.util.Scanner(System.in);

    System.out.print(
      "Enter yearly interest rate, for example, 8.25: ");
    double annualInterestRate = input.nextDouble();

    System.out.print("Enter number of years as an integer: ");
    int numberOfYears = input.nextInt();

    System.out.print("Enter loan amount, for example, 120000.95: ");
    double loanAmount = input.nextDouble();

    Loan loan =
      new Loan(annualInterestRate, numberOfYears, loanAmount);

    System.out.printf("The loan was created on %s\\n" +
      "The monthly payment is %.2f\\nThe total payment is %.2f\\n",
      loan.getLoanDate().toString(), loan.getMonthlyPayment(),
      loan.getTotalPayment());
  }
}
`,
      console: `Enter yearly interest rate, for example, 8.25: 8.25
Enter number of years as an integer: 5
Enter loan amount, for example, 120000.95: 120000.95
The loan was created on Wed Jan 15 00:00:00 CST 2025
The monthly payment is 2447.57
The total payment is 146854.17`,
      steps: [
        "1. The program starts in TestLoanClass.main().",
        "2. A Scanner reads three values from the user: interest rate, years, and loan amount.",
        "3. new Loan(annualInterestRate, numberOfYears, loanAmount) creates a Loan object on the heap.",
        "4. Inside the Loan constructor, fields are set and loanDate is captured.",
        "5. back in main, getMonthlyPayment() uses the amortization formula to compute a monthly payment.",
        "6. getTotalPayment() multiplies the monthly payment by 12 * numberOfYears.",
        "7. printf prints the loan date, monthly payment, and total payment for the user."
      ],
      diagram: `<pre>Stack
  main():
    input → Scanner
    annualInterestRate = 8.25
    numberOfYears      = 5
    loanAmount         = 120000.95
    loan → obj#1 (Loan)

Heap
  obj#1 Loan:
    annualInterestRate = 8.25
    numberOfYears      = 5
    loanAmount         = 120000.95
    loanDate           = (creation date)</pre>`
    },

    "BMI": {
      coreTitle: "BMI.java",
      coreCode: `
public class BMI {
  private String <span class="field explainable" data-explain="Person's name">name</span>;
  private int <span class="field explainable" data-explain="Person's age in years">age</span>;
  private double <span class="field explainable" data-explain="Weight in pounds">weight</span>;
  private double <span class="field explainable" data-explain="Height in inches">height</span>;

  public static final double KILOGRAMS_PER_POUND = 0.45359237;
  public static final double METERS_PER_INCH = 0.0254;

  <span class="ctor explainable" data-explain="Construct BMI with all attributes">public BMI</span>(
      String name, int age, double weight, double height) {
    this.name = name;
    this.age = age;
    this.weight = weight;
    this.height = height;
  }

  <span class="ctor explainable" data-explain="Overloaded constructor with default age 20">public BMI</span>(
      String name, double weight, double height) {
    this(name, 20, weight, height);
  }

  public double getBMI() {
    double bmi = weight * KILOGRAMS_PER_POUND /
      ((height * METERS_PER_INCH) * (height * METERS_PER_INCH));
    return Math.round(bmi * 100) / 100.0;
  }

  public String getStatus() {
    double bmi = getBMI();
    if (bmi < 18.5) return "Underweight";
    else if (bmi < 25) return "Normal";
    else if (bmi < 30) return "Overweight";
    else return "Obese";
  }

  public String getName() { return name; }
}
`,
      testTitle: "UseBMIClass.java",
      testCode: `
public class UseBMIClass {
  public static void main(String[] args) {
    BMI bmi1 = new BMI("John Doe", 18, 145, 70);
    System.out.println("The BMI for " + bmi1.getName() + " is "
      + bmi1.getBMI() + " " + bmi1.getStatus());

    BMI bmi2 = new BMI("Peter King", 215, 70);
    System.out.println("The BMI for " + bmi2.getName() + " is "
      + bmi2.getBMI() + " " + bmi2.getStatus());
  }
}
`,
      console: `The BMI for John Doe is 20.81 Normal
The BMI for Peter King is 30.85 Obese`,
      steps: [
        "1. main() creates bmi1 with all parameters explicitly (name, age, weight, height).",
        "2. getBMI() converts pounds to kilograms and inches to meters, then computes BMI.",
        "3. getStatus() checks BMI ranges and returns a string label.",
        "4. The first println prints John Doe's BMI and status (Normal).",
        "5. bmi2 uses the overloaded constructor, defaulting age to 20.",
        "6. Peter King's BMI is computed and categorized as Obese."
      ],
      diagram: `<pre>Stack
  main():
    bmi1 → obj#1 (BMI)
    bmi2 → obj#2 (BMI)

Heap
  obj#1 BMI:
    name   = "John Doe"
    age    = 18
    weight = 145
    height = 70

  obj#2 BMI:
    name   = "Peter King"
    age    = 20
    weight = 215
    height = 70</pre>`
    },

    "Course": {
      coreTitle: "Course.java",
      coreCode: `
public class Course {
  private String <span class="field explainable" data-explain="Course title">courseName</span>;
  private String[] <span class="field explainable" data-explain="Students enrolled in this course">students</span>
      = new String[100];
  private int <span class="field explainable" data-explain="Current number of students">numberOfStudents</span>;

  <span class="ctor explainable" data-explain="Construct a course with a given name">public Course</span>(
      String courseName) {
    this.courseName = courseName;
  }

  public void addStudent(String student) {
    students[numberOfStudents] = student;
    numberOfStudents++;
  }

  public String[] getStudents() {
    return students;
  }

  public int getNumberOfStudents() {
    return numberOfStudents;
  }

  public String getCourseName() {
    return courseName;
  }

  public void dropStudent(String student) {
    // Left as an exercise in the book
  }
}
`,
      testTitle: "TestCourse.java",
      testCode: `
public class TestCourse {
  public static void main(String[] args) {
    Course course1 = new Course("Data Structures");
    Course course2 = new Course("Database Systems");

    course1.addStudent("Peter Jones");
    course1.addStudent("Brian Smith");
    course1.addStudent("Anne Kennedy");

    course2.addStudent("Peter Jones");
    course2.addStudent("Steve Smith");

    System.out.println("Number of students in course1: "
      + course1.getNumberOfStudents());
    String[] students = course1.getStudents();
    for (int i = 0; i < course1.getNumberOfStudents(); i++)
      System.out.print(students[i] + ", ");

    System.out.println();
    System.out.print("Number of students in course2: "
      + course2.getNumberOfStudents());
  }
}
`,
      console: `Number of students in course1: 3
Peter Jones, Brian Smith, Anne Kennedy, 
Number of students in course2: 2`,
      steps: [
        "1. main() creates two Course objects: course1 and course2.",
        "2. Students are added to each course via addStudent(), which appends to the internal array.",
        "3. course1.getNumberOfStudents() returns 3.",
        "4. The loop retrieves course1's students and prints their names.",
        "5. course2.getNumberOfStudents() returns 2 and is printed.",
        "6. This example illustrates aggregation: a Course 'has many' Students stored in an array."
      ],
      diagram: `<pre>Stack
  main():
    course1 → obj#1 (Course)
    course2 → obj#2 (Course)
    students → reference to array inside course1

Heap
  obj#1 Course:
    courseName       = "Data Structures"
    numberOfStudents = 3
    students[0..2]   = "Peter Jones", "Brian Smith", "Anne Kennedy"

  obj#2 Course:
    courseName       = "Database Systems"
    numberOfStudents = 2
    students[0..1]   = "Peter Jones", "Steve Smith"</pre>`
    },

    "Stack": {
      coreTitle: "StackOfIntegers.java",
      coreCode: `
public class StackOfIntegers {
  private int[] <span class="field explainable" data-explain="Array storing elements of the stack">elements</span>;
  private int <span class="field explainable" data-explain="Number of elements in the stack">size</span>;
  public static final int <span class="stat explainable" data-explain="Default capacity for the stack">DEFAULT_CAPACITY</span> = 16;

  <span class="ctor explainable" data-explain="Constructs a stack with default capacity">public StackOfIntegers()</span> {
    this(DEFAULT_CAPACITY);
  }

  <span class="ctor explainable" data-explain="Constructs a stack with a given capacity">public StackOfIntegers</span>(
      int capacity) {
    elements = new int[capacity];
  }

  public void push(int value) {
    elements[size++] = value;
  }

  public int pop() {
    return elements[--size];
  }

  public int peek() {
    return elements[size - 1];
  }

  public boolean empty() {
    return size == 0;
  }

  public int getSize() {
    return size;
  }
}
`,
      testTitle: "TestStackOfIntegers.java",
      testCode: `
public class TestStackOfIntegers {
  public static void main(String[] args) {
    StackOfIntegers stack = new StackOfIntegers();

    for (int i = 0; i < 10; i++)
      stack.push(i);

    while (!stack.empty())
      System.out.print(stack.pop() + " ");
  }
}
`,
      console: `9 8 7 6 5 4 3 2 1 0 `,
      steps: [
        "1. main() creates a StackOfIntegers with default capacity 16.",
        "2. The for-loop pushes 0,1,2,...,9 onto the stack (10 elements).",
        "3. The top of the stack after the loop is 9.",
        "4. The while-loop pops elements until the stack is empty.",
        "5. Because stacks are LIFO, the numbers come out in reverse order: 9 down to 0.",
        "6. This demonstrates how a stack can be used to reverse a sequence."
      ],
      diagram: `<pre>Stack
  main():
    stack → obj#1 (StackOfIntegers)

Heap
  obj#1 StackOfIntegers:
    elements[0..9] = 0,1,2,3,4,5,6,7,8,9
    size           = 0  (after popping all elements)</pre>`
    },

    "Palindrome": {
      coreTitle: "PalindromeIgnoreNonAlphanumeric.java (core)",
      coreCode: `
public class PalindromeIgnoreNonAlphanumeric {
  public static void main(String[] args) {
    java.util.Scanner input = new java.util.Scanner(System.in);

    System.out.print("Enter a string: ");
    String s = input.nextLine();

    System.out.println("Ignoring non-alphanumeric characters, \\nis "
      + s + " a palindrome? " + isPalindrome(s));
  }

  public static boolean isPalindrome(String s) {
    String filtered = filter(s);
    String reversed = reverse(filtered);
    return filtered.equalsIgnoreCase(reversed);
  }

  public static String filter(String s) {
    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < s.length(); i++) {
      char ch = s.charAt(i);
      if (Character.isLetterOrDigit(ch)) {
        sb.append(ch);
      }
    }
    return sb.toString();
  }

  public static String reverse(String s) {
    StringBuilder sb = new StringBuilder(s);
    sb.reverse();
    return sb.toString();
  }
}
`,
      testTitle: "Standalone Program",
      testCode: `// This class contains both main and helper methods.
// There is no separate Test class.`,
      console: `Enter a string: A man, a plan, a canal: Panama
Ignoring non-alphanumeric characters, 
is A man, a plan, a canal: Panama a palindrome? true`,
      steps: [
        "1. main() prompts the user for a string (which may contain spaces/punctuation).",
        "2. isPalindrome(s) is called with the original string.",
        "3. filter(s) builds a new string with only letters and digits.",
        "4. reverse(filtered) creates a reversed version.",
        "5. equalsIgnoreCase() compares the filtered and reversed strings, ignoring case.",
        "6. If they match, the original input is considered a palindrome ignoring non-alphanumeric characters."
      ],
      diagram: `<pre>Stack
  main():
    s         = "A man, a plan, a canal: Panama"
  isPalindrome():
    filtered  = "AmanaplanacanalPanama"
    reversed  = "amanaPlanaCanalpanamA"

Heap
  String objects:
    original = "A man, a plan, a canal: Panama"
    filtered = "AmanaplanacanalPanama"
    reversed = "amanaPlanaCanalpanamA"</pre>`
    },

    "LargeFact": {
      coreTitle: "LargeFactorial.java",
      coreCode: `
import java.math.BigInteger;

public class LargeFactorial {
  public static void main(String[] args) {
    System.out.println("50! is \\n" + factorial(50));
  }

  public static BigInteger factorial(long n) {
    BigInteger result = BigInteger.ONE;
    for (int i = 1; i <= n; i++)
      result = result.multiply(new BigInteger(i + ""));
    return result;
  }
}
`,
      testTitle: "Standalone Program",
      testCode: `// LargeFactorial is itself the main and utility class.
// It demonstrates using BigInteger for very large results.`,
      console: `50! is 
30414093201713378043612608166064768844377641568960512000000000000`,
      steps: [
        "1. main() calls factorial(50).",
        "2. factorial uses BigInteger, since 50! is far bigger than fits in long or double.",
        "3. result starts as BigInteger.ONE.",
        "4. For i from 1 to 50, result = result * i (wrapped in a BigInteger).",
        "5. After the loop, result holds 50! exactly with no overflow.",
        "6. main() prints the full value of 50!."
      ],
      diagram: `<pre>Stack
  main():
    (no named variables besides args)
  factorial():
    n      = 50
    i      = loop variable
    result = BigInteger (grows each iteration)

Heap
  BigInteger objects created during multiplications,
  final result representing 50! exactly.</pre>`
    }
  };

  // ------------------------------------------------------------
  // EXECUTION STEPPER (shared by chapters 9 & 10)
  // ------------------------------------------------------------
  let currentSteps = [];
  let currentStepIndex = 0;

  function setStepsForExample(steps, diagramHtml, chapterPrefix) {
    currentSteps = steps || [];
    currentStepIndex = 0;

    const diagramEl = document.getElementById(`ex${chapterPrefix}Diagram`);
    if (diagramEl) {
      diagramEl.innerHTML = diagramHtml || "(No diagram yet.)";
    }
    updateStepText(chapterPrefix);
  }

  function updateStepText(chapterPrefix) {
    const stepEl = document.getElementById(`ex${chapterPrefix}StepText`);
    if (!stepEl) return;

    if (!currentSteps.length) {
      stepEl.textContent = "(No step-by-step explanation provided for this example.)";
    } else {
      stepEl.textContent = currentSteps[currentStepIndex];
    }
  }

  function nextStep(chapterPrefix) {
    if (!currentSteps.length) return;
    currentStepIndex = (currentStepIndex + 1) % currentSteps.length;
    updateStepText(chapterPrefix);
  }

  function prevStep(chapterPrefix) {
    if (!currentSteps.length) return;
    currentStepIndex = (currentStepIndex - 1 + currentSteps.length) % currentSteps.length;
    updateStepText(chapterPrefix);
  }

  // ------------------------------------------------------------
  // LOAD A CHAPTER 9 EXAMPLE
  // ------------------------------------------------------------
  function loadCH9Example(key) {
    document.querySelectorAll(".ex9-btn").forEach(b => b.classList.remove("active"));
    document.getElementById("btn_" + key).classList.add("active");

    const ex = chapter9Examples[key];

    document.getElementById("ex9Code").innerHTML = ex.code;
    document.getElementById("ex9Console").textContent = ex.console;

    setStepsForExample(ex.steps, ex.diagram, "9");

    document.getElementById("chapter9").scrollIntoView({ behavior: "smooth" });
  }

  // ------------------------------------------------------------
  // LOAD A CHAPTER 10 EXAMPLE (Option C — auto pairing)
  // ------------------------------------------------------------
  function loadCH10Example(key) {
    document.querySelectorAll(".ex10-btn").forEach(b => b.classList.remove("active"));
    document.getElementById("btn10_" + key).classList.add("active");

    const ex = chapter10Examples[key];

    document.getElementById("ex10CoreCode").innerHTML   = ex.coreCode;
    document.getElementById("ex10TestCode").innerHTML   = ex.testCode;
    document.getElementById("ex10Console").textContent  = ex.console;

    setStepsForExample(ex.steps, ex.diagram, "10");

    document.getElementById("chapter10").scrollIntoView({ behavior: "smooth" });
  }

  // ------------------------------------------------------------
  // ANALYZER: Highlight + Structured Breakdown
  // ------------------------------------------------------------
  function analyzePastedCode() {
    const src = document.getElementById("analyzeInput").value || "";
    const lines = src.split(/\r?\n/);

    const classes = [];
    const interfaces = [];
    const fields = [];
    const constructors = [];
    const methods = [];
    const staticMembers = [];
    const news = [];
    const thisRefs = [];
    const superRefs = [];
    const inheritanceInfo = [];
    const exceptions = [];

    let currentClass = null;

    const stripComments = (line) =>
      line.replace(/\/\/.*$/, "").replace(/\/\*.*\*\//g, "");

    const escapeHtml = (s) =>
      s.replace(/&/g, "&amp;")
       .replace(/</g, "&lt;")
       .replace(/>/g, "&gt;");

    const highlightedLines = [];

    lines.forEach((rawLine, idx) => {
      const lineNo = idx + 1;
      let line = stripComments(rawLine).trim();

      // ----- ANALYSIS (lists) -----
      if (line) {
        let m;

        // class / interface
        if ((m = line.match(/\bclass\s+([A-Za-z_]\w*)/))) {
          const name = m[1];
          currentClass = name;
          let extendsMatch = line.match(/\bextends\s+([A-Za-z_]\w*)/);
          let implementsMatch = line.match(/\bimplements\s+([A-Za-z_][\w,\s]*)/);
          let info = `class ${name}`;
          if (extendsMatch) info += ` extends ${extendsMatch[1]}`;
          if (implementsMatch) info += ` implements ${implementsMatch[1].trim()}`;
          classes.push(`${info}  (line ${lineNo})`);
          if (extendsMatch || implementsMatch) {
            inheritanceInfo.push(`${info}  (line ${lineNo})`);
          }
        } else if ((m = line.match(/\binterface\s+([A-Za-z_]\w*)/))) {
          interfaces.push(`interface ${m[1]}  (line ${lineNo})`);
        }

        // 'new' expressions
        if (line.includes(" new ")) {
          news.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // 'this' and 'super'
        if (line.includes("this")) {
          thisRefs.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }
        if (line.includes("super")) {
          superRefs.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // inheritance keywords in non-class lines
        if (/\bextends\b|\bimplements\b/.test(line)) {
          inheritanceInfo.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // exceptions
        if (/\btry\b/.test(line) || /\bcatch\b/.test(line) ||
            /\bthrow\b/.test(line) || /\bthrows\b/.test(line)) {
          exceptions.push(`"${rawLine.trim()}"  (line ${lineNo})`);
        }

        // skip obvious control-flow statements from method detection
        const controlKeywords = ["if ", "for ", "while ", "switch ", "catch ", "try ", "do "];
        const isControl = controlKeywords.some(kw =>
          line.startsWith(kw) || line.startsWith(kw.trim() + "(")
        );

        // methods / constructors heuristic
        if (!isControl && /\w+\s*\(.*\)\s*[{;]?$/.test(line)) {
          const sig = line.replace(/{.*$/, "").trim();
          const parts = sig.split(/\s+/);
          const parenIndex = sig.indexOf("(");
          const beforeParen = sig.substring(0, parenIndex).trim();
          const nameMatch = beforeParen.match(/([A-Za-z_]\w*)$/);
          const name = nameMatch ? nameMatch[1] : null;

          if (name) {
            if (currentClass && name === currentClass) {
              constructors.push(`Constructor: ${sig}  (line ${lineNo})`);
            } else {
              let returnType = "unknown";
              if (parts.length >= 2) {
                returnType = parts[parts.length - 2];
              }
              methods.push(`Method: ${name}  → returns ${returnType}  (line ${lineNo})`);
            }

            if (sig.includes(" static ")) {
              staticMembers.push(`"${rawLine.trim()}"  (line ${lineNo})`);
            }
          }
        }

        // fields (very rough)
        if (line.endsWith(";") && !line.includes("(") && !line.includes(")") &&
            !line.includes(" class ") && !line.startsWith("class ") &&
            !line.includes(" interface ") && !line.startsWith("interface ") &&
            !line.startsWith("import ") && !line.startsWith("package ")) {
          fields.push(`${line.replace(/;/, "").trim()}  (line ${lineNo})`);
          if (/\bstatic\b/.test(line)) {
            staticMembers.push(`"${rawLine.trim()}"  (line ${lineNo})`);
          }
        }
      }

      // ----- HIGHLIGHTED CODE VIEW -----
      let h = escapeHtml(rawLine);

      h = h.replace(/\bstatic\b/g,
        '<span class="hl-static">static</span>');
      h = h.replace(/\bnew\b/g,
        '<span class="hl-new">new</span>');
      h = h.replace(/\bthis\b/g,
        '<span class="hl-this">this</span>');
      h = h.replace(/\bextends\b|\bimplements\b/g,
        '<span class="hl-inherit">$&</span>');
      h = h.replace(/\bsuper\b/g,
        '<span class="hl-inherit">super</span>');
      h = h.replace(/\btry\b|\bcatch\b|\bthrow\b|\bthrows\b/g,
        '<span class="hl-exception">$&</span>');

      if (/\b(int|double|boolean|char|String|long|float|short|byte)\b/.test(rawLine) &&
          rawLine.includes(";") && !rawLine.includes("(")) {
        h = '<span class="hl-field">' + h + '</span>';
      }

      highlightedLines.push(h);
    });

    const codeViewEl = document.getElementById("analyzeCodeView");
    codeViewEl.innerHTML = highlightedLines.join("\n");

    const summaryEl = document.getElementById("analyzeSummary");
    const outClasses = document.getElementById("analyzeClasses");
    const outInterfaces = document.getElementById("analyzeInterfaces");
    const outFields = document.getElementById("analyzeFields");
    const outCtors = document.getElementById("analyzeConstructors");
    const outMethods = document.getElementById("analyzeMethods");
    const outStatic = document.getElementById("analyzeStatic");
    const outNew = document.getElementById("analyzeNew");
    const outThis = document.getElementById("analyzeThis");
    const outSuper = document.getElementById("analyzeSuper");
    const outInherit = document.getElementById("analyzeInherit");
    const outExc = document.getElementById("analyzeExceptions");

    function fillList(listEl, arr) {
      listEl.innerHTML = "";
      if (!arr.length) {
        const li = document.createElement("li");
        li.textContent = "(none detected)";
        listEl.appendChild(li);
      } else {
        arr.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          listEl.appendChild(li);
        });
      }
    }

    const totalClasses = classes.length;
    const totalInterfaces = interfaces.length;
    const totalFields = fields.length;
    const totalMethods = methods.length;
    const totalCtors = constructors.length;

    summaryEl.textContent =
      `Detected ${totalClasses} class(es), ${totalInterfaces} interface(s), `
      + `${totalFields} field(s), ${totalCtors} constructor(s), ${totalMethods} method(s).`;

    fillList(outClasses, classes);
    fillList(outInterfaces, interfaces);
    fillList(outFields, fields);
    fillList(outCtors, constructors);
    fillList(outMethods, methods);
    fillList(outStatic, staticMembers);
    fillList(outNew, news);
    fillList(outThis, thisRefs);
    fillList(outSuper, superRefs);
    fillList(outInherit, inheritanceInfo);
    fillList(outExc, exceptions);
  }

  // ------------------------------------------------------------
  // INITIALIZE DEFAULT CH9 & CH10 EXAMPLES
  // ------------------------------------------------------------
  window.addEventListener("DOMContentLoaded", () => {
    loadCH9Example("CircleWithStatic");
    loadCH10Example("Loan");
  });

  // ------------------------------------------------------------
  // OPTIONAL: SERVICE WORKER REGISTRATION (for PWA)
  // ------------------------------------------------------------
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(err => {
      console.log('Service worker registration failed:', err);
    });
  }
</script>

</body>
</html>
